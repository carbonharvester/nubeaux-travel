[build]
  publish = "."
  functions = "netlify/functions"

# Redirects
[[redirects]]
  from = "/login"
  to = "/portal/login.html"
  status = 301

[[redirects]]
  from = "/portal"
  to = "/portal/index.html"
  status = 301

[[redirects]]
  from = "/portal/edit-itinerary"
  to = "/portal/edit-itinerary.html"
  status = 301

[functions]
  node_bundler = "esbuild"

# Extend timeout for functions that do heavy processing
[functions."get-highlights"]
  timeout = 60

[functions."download-stories"]
  timeout = 60

[functions."sync-profile"]
  timeout = 60

[functions."generate-itinerary"]
  timeout = 60

# Background function for processing Apify webhooks
# Background functions can run up to 15 minutes
[functions."process-sync-background"]
  # This is a background function (file ends with -background.js)
  # It receives webhooks from Apify and processes data asynchronously

[context.production.environment]
  NODE_VERSION = "18"

# Security headers
[[headers]]
  for = "/*"
  [headers.values]
    X-Frame-Options = "DENY"
    X-Content-Type-Options = "nosniff"
    Referrer-Policy = "strict-origin-when-cross-origin"
    Content-Security-Policy = "frame-ancestors 'none'"

# Cache static assets
[[headers]]
  for = "/assets/*"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
  for = "/css/*"
  [headers.values]
    Cache-Control = "public, max-age=86400"

[[headers]]
  for = "/js/*"
  [headers.values]
    Cache-Control = "public, max-age=86400"
